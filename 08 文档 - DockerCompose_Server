服务类Docker部署步骤：
一、创建总目录
mkdir /dockerFile/dfServer

二、构建镜像
1. mysql
1）创建dfMysql文件夹
mkdir /dockerFile/dfServer/dfMysql
2）创建Dockerfile-mysql
touch /dockerFile/dfServer/dfMysql/Dockerfile-mysql
内容如下：
FROM mysql:5.7
RUN apt-get update
RUN apt-get install -y vim
RUN echo '[mysqld]'>>/etc/mysql/conf.d/mysql.cnf
RUN echo 'sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'>>/etc/mysql/conf.d/mysql.cnf
RUN cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && echo 'Asia/Shanghai'>/etc/timezone

FROM mysql:8.0
RUN apt-get update
RUN apt-get install -y vim
RUN echo '[mysqld]'>>/etc/mysql/conf.d/mysql.cnf
RUN echo 'sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION'>>/etc/mysql/conf.d/mysql.cnf
RUN cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && echo 'Asia/Shanghai'>/etc/timezone
2. redis
1）创建dfRedis文件夹
mkdir /dockerFile/dfServer/dfRedis
2）创建/dockerFile/dfServer/dfRedis/conf 将 挂载的redis.conf 复制进去
3）docker pull redis:5.0
注意，配置文件挂载需要修改的配置
# daemonize yes    # 一定要注释掉，不然启动不了容器
protected-mode no
bind 0.0.0.0
appendonly yes      # 使用aof 持久化
# save 900 1        # 不用rdb 持久化
# save 300 10
# save 60 10000
requirepass Yifan123.
3. jenkins
1）创建dfM文件夹
mkdir /dockerFile/dfServer/dfJenkins
2）在文件夹中加入apache-maven-3.6.3-bin.tar.gz
3）创建Dockerfile-mysql
touch /dockerFile/dfServer/dfJenkins/Dockerfile-jenkins
内容如下：
FROM jenkinsci/blueocean
USER root
# WORKDIR /var/maven3 # 在容器内部设置工作目录，在构建中为后续的指令指定工作目录
ADD ./dfServer/dfJenkins/apache-maven-3.6.3-bin.tar.gz ./ # 将文件或目录复制到使用Dockerfile构建的镜像中，注意ADD指令自带解压缩功能
# 用来设置环境变量，作用于构建构过程或运行过程中
ENV MAVEN_HOME=./apache-maven-3.6.3
#ENV MAVEN_OPTS=[-Xms256m -Xmx512m]
ENV PATH=$PATH:$MAVEN_HOME/bin
# 运行指令
RUN echo "MAVEN_HOME=./apache-maven-3.6.3\nMAVEN_OPTS=-Xms256m -Xmx512m\nPATH=$PATH:$MAVEN_HOME/bin" >> /etc/profile


二、编写docker-compose-server.yml
touch /dockerFile/docker-compose-server.yml
内容如下：
version: '3'
services:
  mysql:
    build:
      dockerfile: /dockerFile/dfServer/dfMysql/Dockerfile-mysql
      context: .
    image: mysql-java
    restart: always
    privileged: true
    container_name: mysql-java
    volumes:
      - /dockerFile/dfServer/dfMysql/logs:/logs
      - /dockerFile/dfServer/dfMysql/data:/var/lib/mysql
    environment:
      TZ: Asia/Shanghai
      MYSQL_ROOT_PASSWORD: Yifan123.
    ports:
      - '3306:3306'
    networks:
      eureka-net:
        aliases:
          - mysql-java
  redis:
    image: redis:5.0
    restart: always
    privileged: true
    container_name: redis-java
    ports:
      - 6379:6379
    volumes:
      - /dockerFile/dfServer/dfRedis/conf/redis.conf:/etc/redis/redis.conf
      - /dockerFile/dfServer/dfRedis/data:/data
    command:
      redis-server /etc/redis/redis.conf --appendonly yes
    networks:
      eureka-net:
        aliases:
          - redis-java
  jenkins:
    build:
      dockerfile: /dockerFile/dfServer/dfJenkins/Dockerfile-jenkins
      context: .
    image: jenkins-java-maven:1.0.0
    privileged: true
    container_name: jenkins-java-maven
    ports:
      - 8099:8080
      - 50000:50000
    volumes:
      - /dockerFile/tool/jenkins:/var/jenkins_home
    networks:
      eureka-net:
        aliases:
          - jenkins-java
networks:
  eureka-net:
    external:
      name: app_net # 指定网络
#     driver: bridge

三. 构建镜像【目前只会编译出mysql镜像，因为redis是直接用下载的镜像】
docker-compose -f docker-compose-server.yml build

四、启动容器
docker-compose -f docker-compose-server.yml up -d


执行前对挂载的目录进行处理：chown -R 1000:1000 /dockerFile/maven/apache-maven-3.6.3
docker run -d -p 8099:8080 --name jenkins_maven -p 50000:50000 -v /dockerFile/tool/jenkins:/var/jenkins_home jenkins-java-maven:1.0.0
-v /dockerFile/tool/maven/apache-maven-3.6.3:/usr/local/maven
-v /dockerFile/tool/profile:/etc/profile
-v /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.262.b10-0.el7_8.x86_64:/usr/local/jdk

